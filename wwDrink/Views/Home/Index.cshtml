@model wwDrink.Models.SearchModel
@{
    ViewBag.Title = "wwDrink";
}
@section featured {
    <script type="text/javascript">
        var screenName = '@ViewBag.ScreenName';
        var currentEstablishment = '@ViewBag.Establishment';
        var currentReview = '@ViewBag.Review';
    </script>
    <section class="featured">
        <form>
            <div class="content-wrapper">
                <div class="left-picture">
                    <img id="drink_image" src="/Images/Pint.jpg" width="140" height="400" style="margin-top: 15px; margin-left: 80px;" />
                </div>
                <div>
                    <div class="title-search-wrapper">
                        <div class="title-box">
                            <hgroup class="title">
                                <h3>Bars, Pubs & Clubs</h3>
                                <h1>@ViewBag.Title</h1>
                                <h2>@ViewBag.Message</h2>
                            </hgroup>
                        </div>
                        <div class="main-search">
                            <input id="search_query" type="text" data-bind="value: searchText"/>
                            <select id="search_type" style="display: none">
                                <option value="location">Location</option>
                                <option value="drink">Drink</option>
                            </select>
                            <input id="search_button" type="submit" value="Search" data-bind="click: SearchClick"/>
                            <div class="fb-like" data-href="http://www.wwdrink.com" data-layout="standard" data-action="like" data-show-faces="true" data-share="true" width="250px">
                            </div>

                            <div style="display:none">
                                Latitude: <label id="latitude_label" data-bind="text: latitude">not set</label>
                                Longitude: <label id="longitude_label" data-bind="text: longitude"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-wrapper">
                <div id="search_results">
                    <div id="establishments" class="stepcarousel">
                        <div class ="belt">
                            <div>
                                <div data-bind="foreach: Establishments">
                                    <div class="panel" data-bind="click: $parent.SelectEstablishmentClick, id: PK">
                                        <div class="establishment-open"  data-bind="visible: open()"><span>Open</span></div>
                                        <div class="establishment-closed" data-bind="visible: !open()"><span>Currently Closed</span></div>
                                        <div class="establishment">
                                            <h4 data-bind="text: name"></h4>
                                            <img data-bind="attr:{src: imageUrl}" alt="loading image" width="174" height="102" /><br/>
                                            <span data-bind="text: suburb"> </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <div class="nav-buttons-back">
                            <input id="StepFirstButton" type="button" data-bind="click: StepFirst" value ="&nbsp;&nbsp;<<&nbsp;&nbsp;" /> <input id="StepBackButton" type="button" data-bind="click: StepBack" value="&nbsp;&nbsp;<&nbsp;&nbsp;" />
                        </div>
                        <div class="nav-buttons-forward">
                            <input id="StepForwardButton" type="button" data-bind="click: StepForward" value="&nbsp;&nbsp;>&nbsp;&nbsp;"/><input id="StepLastButton" type="button" data-bind="click: StepLast" value="&nbsp;&nbsp;>>&nbsp;&nbsp;" />
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </section>
}
<link rel="stylesheet" href="~/Content/themes/base/jquery.ui.all.css">
<link rel="stylesheet" href="~/Content/rateit.css">

<div id="results_tabs">

    <ul class="tab-header">
        <li class="tab-item" style="background-image: none;">
            <div class="tab-background">
                <a href="#results_tabs-0">Map</a>          
            </div>
        </li>
        <!-- ko foreach: Interests -->
        <li class="tab-item" style="background-image: none; display: inline" >
            <div class="tab-background">
                <img src="/Images/close_button.png" class="close-button" alt="close" data-bind="click: $parent.CloseTab, visible: $parent.IsMacUser" />
                <span>
                    <a data-bind="attr: { href: tab_href }"><span data-bind="text: name"></span></a>
                </span>
                <div class="tab-close-button">
                    <img src="/Images/close_button.png" class="close-button" alt="close" style="float:right" data-bind="click: $parent.CloseTab, visible: $parent.IsWindowsUser "/>
                </div>
            </div>
        </li>
        <!-- /ko -->
    </ul>
    <div class="google-as-left">
        <div class="mock-ad">
            Ad Left
        </div>
    </div>
    <div class="google-as-right">
        <div class="mock-ad">
            Ad Right
        </div>
    </div>
    <div id="result_pages">
        <div id="results_tabs-0">
            <div id="map" style="width: 100%; min-height: 400px; margin-top:20px">
            </div>
            <div id="infowindow"></div>
        </div>
        <!-- ko foreach: Interests -->
        <div data-bind="attr: {id: tab_name }">
            <div class="establishment-listing">
                <ul>
                    <li>
                        <div class="establishment-details-header-image">
                            <img class="establishment-details-current-image" data-bind="attr:{src: imageUrl}" width="240px" height="180px" alt="Details Page Image" src="/Images/missing_establishment_image.png"/>
                            <div class="establishment-image-thumbnails" data-bind="foreach: photos">
                                <div class="establishment-image-thumbnail">
                                    <a data-bind="click: $parent.UpdateImage">
                                        <img class="establishment-images-thumbnail" data-bind="attr:{src: imageUrl}" width="48px" height="36px" alt="Details Page Image" src="/Images/missing_establishment_image.png"/>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="establishment-details-header">
                            <h4><span data-bind="text: name"></span></h4>
                            <span class="establishment-address" data-bind="text: address"></span>
                            <hr/>
                            <span class="open-hours-title">Open:</span><br/>
                            <!-- ko foreach: open_hours -->
                            <span class="open-hours" data-bind="text: open_hours"></span><br/>
                            <!-- /ko -->
                        </div>
                    </li>
                    <li>
                        <div class="establishment-ratings">
                            <div class="establishment-rating" style="display: table-row">
                                <div class="aspect-rating-name">
                                    <span></span>
                                </div>
                                <div class="aspect-rating-rating">
                                    <div data-bind="rateit : { value: Rating, max: 5, step: 0.1, readonly: true }"></div>
                                </div>
                            </div>
                            <!-- ko foreach: features -->
                            <div class="establishment-rating" style="display: table-row">
                                <div class="aspect-rating-name">
                                    <span data-bind="text: Name"></span>:
                                </div>
                                <div class="aspect-rating-rating">
                                    <div data-bind="rateit :  { value: Rating, max: 5, step: 0.1, readonly: true }"></div>
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>
                    </li>
                </ul>
                <div class="establishment-like">
                    <div class="fb-like" data-bind="attr: { 'data-href': EstablishmentLikeHref, id: fbLinkId }, updateFacebook: true, visible: ShowFacebookLike" data-layout="standard" data-action="like" data-show-faces="true" data-share="true">
                    </div>
                </div>
            </div>
            @if (Request.IsAuthenticated)
            {
                <div class="AddReview" data-bind="visible: AllowAddReview">
                    <div class="add-review-collapsed" data-bind="visible: NotAddingReview">
                        <input type="submit" id="ShowAddReviewButton" value="Add Review" data-bind="click: ShowAddReviewClick"/>
                    </div>
                    <div class="add-review-overall-rating" data-bind="visible: AddingReview">
                        <div class="add-review-ratings">
                            <div class="add-review-search-aspect">
                                <div class="add-review-search-aspect-cell">
                                    &nbsp;
                                </div>
                                <div class="add-review-search-aspect-cell">
                                    <div data-bind="rateit: ReviewRating"></div>
                                </div>
                            </div>
                            <div class="add-review-search-aspect">
                                <div class="add-review-search-aspect-cell">
                                    Key aspects:
                                </div>
                                <div class="add-review-search-aspect-cell">
                                    &nbsp;
                                </div>
                            </div>
                            <div class="add-review-search-aspect">
                                <div class="add-review-search-aspect-cell">
                                    <input class="search-aspect" type="text" data-bind="autoComplete: availableAspects, value: SearchAspect, autoCompleteOptions: {autoFocus: false}" /> 
                                </div>
                                <div class="add-review-search-aspect-cell">
                                    <a href="#" data-bind="click: AddAspect, visible: AddAspectVisible">Add Aspect</a>
                                </div>
                            </div>
                            <!-- ko foreach: ReviewAspects -->
                            <div class="add-review-aspect">
                                <div class="add-review-aspect-cell">
                                    <button class="add-review-remove-aspect" data-bind="click: $parent.DeleteAspect"></button>
                                    <span data-bind="text: Name"></span> 
                                </div>
                                <div class="add-review-aspect-cell">
                                    <div class="add-review-rating" data-bind="rateit: Rating"></div>
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                    <div class="ReviewPanel" data-bind="visible: AddingReview">
                        <form>
                            <div class="rateit: Rating"></div><br/>
                
                            <textarea name="ReviewText" id="ReviewText" rows="5" style="width:60%;" data-bind="value: ReviewText"></textarea>
                            <br/>
                            <input type="submit" id="AddReviewButton" value="Post Review" data-bind="click: $parent.AddReviewClick"/>
                        </form>
                    </div>
                </div>
            }
            else
            {
                <div class="UserNotAuthorized">
                    <div class="login_social_media">To leave a review, log on with one of the following: <br/>
                        <section class="social" id="socialLoginForm">
                            @Html.Action("ExternalLoginsList", new { ReturnUrl = ViewBag.ReturnUrl })
                        </section>
                    </div>
                </div>
            }
            
            <div class="establishment-reviews" data-bind="foreach: reviews">
                <div class="establishment-review">
                    <div data-bind="attr: { id: pk}">
                        <div class="review-header">
                            <div class="review-author">
                                <h4>Review by: <span data-bind="text: author"></span></h4>
                            </div>
                            <div class="review-date">
                                Review date: <span data-bind="text: date"></span>
                            </div>
                        </div>
                        <div class="review-overall-rating">
                            <div data-bind="rateit: { value: rating, max: 5, step: 0.1, readonly: true }"></div>
                        </div>
                        <div class="review-body">
                            <div class="review-text">
                                <p>
                                    <span data-bind="text: review_short, visible: ShowShortReview" ></span>
                                    <a href="#" data-bind="click: ToggleReview, visible: ShowMoreButton">show more</a>
                                    <span data-bind="text: review, visible: ShowFullReview"></span>
                                    <a href="#" data-bind="click: ToggleReview, visible: ShowLessButton">hide</a>
                                </p>
                            </div>
                            <div class="aspect-rating">
                                <div data-bind="foreach: aspects">
                                    <div style="display: table-row">
                                        <div class="aspect-rating-name">
                                            <span data-bind="text: aspectType"></span>                        
                                        </div>
                                        <div class="aspect-rating-rating">
                                            <div data-bind="rateit: { value: rating, max: 5, step: 0.1, readonly: true }"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="review-like">
                            <div class="fb-like" data-bind="attr: { 'data-href': ReviewLikeHref, id: fbLinkId  }, updateFacebook: true, visible: ShowLikeReview" data-href="@Request.Url" data-layout="standard" data-action="like" data-show-faces="true" data-share="true">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/Scripts/underscore.js")
    @Scripts.Render("~/Scripts/jquery-ui-1.8.20.js")
    @Scripts.Render("~/Scripts/jquery.rateit.min.js")
    @Scripts.Render("~/Scripts/stepcarousel.js")
    @Scripts.Render("~/Scripts/knockout-2.1.0.js")
    @Scripts.Render("~/Scripts/knockout-binding-handlers.js")
    @Scripts.Render("~/Scripts/guid.js")
    @Scripts.Render("http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false")
    @Scripts.Render("~/Scripts/Client/Aspect.js")
    @Scripts.Render("~/Scripts/Client/Review.js")
    @Scripts.Render("~/Scripts/Client/Establishment.js")
    @Scripts.Render("~/Scripts/Client/Search.js")
    @Scripts.Render("~/Scripts/Client/home.js")
}
